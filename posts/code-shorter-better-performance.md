# โพสต์: ผมอยากให้ Code หน้านี้สั้นลง โดยที่ performance ต้องดีขึ้น ต้องทำยังไง

---

## คำถาม

> ผมอยากให้ Code หน้านี้สั้นลง  
> โดยที่ performance ต้องดีขึ้น  
> ต้องทำยังไง

---

## คำตอบสั้น ๆ

**ทำให้โค้ดสั้นลง + performance ดีขึ้น** ทำได้ด้วยการ **แยกส่วนที่ซ้ำออกมาใช้ซ้ำ**, **โหลดเฉพาะตอนต้องใช้**, และ **ลดการคำนวณ/เรนเดอร์ที่ไม่จำเป็น**

---

## 1. แยก Component / Hook ออกมาใช้ซ้ำ (โค้ดสั้น + อ่านง่าย)

- **ก่อน:** logic ยาว ๆ อยู่ในหน้าเดียว → ไฟล์ยาว อ่านยาก
- **หลัง:** ดึงส่วนที่ใช้ซ้ำเป็น component หรือ custom hook → หน้าเหลือแค่การจัดวางและเรียกใช้

**ผลต่อ performance:** โค้ดแยกส่วนแล้ว React จัดการ re-render แยกตาม component ได้ดีขึ้น และใช้ `React.memo` กับ component ย่อยได้ตรงจุด

```tsx
// แทนที่จะเขียน logic ยาวในหน้า
// สร้าง usePostsFeed() หรือ <PostList /> แล้วเรียกในหน้า
```

---

## 2. Lazy Load / Code Splitting (โค้ดสั้นใน bundle + โหลดเร็วขึ้น)

- หน้าโหลดครั้งแรก **โหลดเฉพาะส่วนที่ต้องแสดง**
- ส่วนอื่น (modal, tab ล่าง, หน้าอื่น) ให้โหลดทีหลังผ่าน `next/dynamic` หรือ `React.lazy`

**ผล:** bundle ต่อหน้าน้อยลง → โหลดเร็วขึ้น, Time to Interactive ดีขึ้น

```tsx
const HeavyModal = dynamic(() => import('@/components/HeavyModal'), {
  loading: () => <Spinner />,
  ssr: false, // ถ้าไม่ต้องใช้ใน SSR
});
```

---

## 3. Memo – ลดการคำนวณและเรนเดอร์ซ้ำ

- **useMemo:** คำนวณค่าแพง (filter, sort, map ใหญ่) แค่เมื่อ dependency เปลี่ยน
- **useCallback:** ฟังก์ชันที่ส่งลง child ไม่ถูกสร้างใหม่ทุกเรนเดอร์ → child ที่ใช้ `React.memo` จะไม่เรนเดอร์ซ้ำโดยไม่จำเป็น
- **React.memo:** component ที่รับ props เดิมไม่เรนเดอร์ใหม่

**ผล:** CPU น้อยลง, เรนเดอร์น้อยลง → รู้สึกลื่นขึ้น

---

## 4. ดึง Logic ซ้ำไปไว้ที่ Server / API

- ถ้ามี logic ที่ทำทั้งฝั่ง client และ server ซ้ำกัน หรือ logic ที่หนัก (aggregate, search) ให้ย้ายไปทำใน **API Route / Server Action / RPC**
- หน้าเหลือแค่ **เรียก API + แสดงผล**

**ผล:** โค้ดหน้ามีแต่ส่วน UI, bundle เล็กลง, งานหนักไปอยู่ฝั่ง server ที่ scale ได้ดีกว่า

---

## 5. รายการเช็คสั้น ๆ

| เป้าหมาย              | วิธีที่ช่วยได้ |
|-----------------------|----------------|
| โค้ดสั้นลง            | แยก component / hook, ย้าย logic ไป API |
| โหลดเร็วขึ้น          | Code splitting, lazy load, ลด bundle |
| ลื่นขึ้น / คำนวณน้อย  | useMemo, useCallback, React.memo |
| โครงสร้างชัด          | หนึ่ง component หนึ่งหน้าที่, ตั้งชื่อให้สื่อความหมาย |

---

## สรุปหนึ่งบรรทัด

**“แยกส่วนใช้ซ้ำ + โหลดทีหลัง + memo ตรงจุด”** จะช่วยให้ทั้งโค้ดสั้นลงและ performance ดีขึ้นได้พร้อมกัน

ถ้าส่งไฟล์หรือชื่อหน้ามาได้ จะช่วยดูเป็นจุด ๆ ว่าแยกตรงไหนก่อนถึงจะได้ผลเร็วที่สุดครับ
